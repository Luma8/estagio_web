<template>

	<h1 class="mb-0 text-[24px] mb-[8px] font-bold">Dashboard Admin</h1>
	<p class="font-[500] text-[14px] mb-[12px] text-[#0365F8]">Dashboard</p>
	<div class="rounded-t-2xl flex gap-[12px]">
		<div class="w-[30%] 2xl:w-[25%]">
			<div class="p-[8px] relative bg-white w-full rounded-xl">
				<div class="absolute p-[8px] top-0 z-0 left-0 right-0">
					<img class="w-full" src="images/LayoutNine/bg2.png" />
				</div>
				<div class="z-50 relative items-center justify-center flex w-full">
					<div class="mt-[94px] flex flex-col items-center justify-center w-full">
						<img class="w-[148px] h-[148px] rounded-full" src="images/LayoutThree/placeholderUser.png" />
						<h1 class="mt-[9px] font-bold">Linda Blair</h1>
						<span class="px-[10px] py-[2px] rounded-md bg-[#E9FAF7] text-[#1A9882]">Active</span>
						<span class="border boder-gray-300/90 my-[16px] w-full"></span>
					</div>
				</div>
				<div class="flex flex-col gap-y-[18px]">
					<div class="flex items-center px-[24px] gap-4">
						<div class="w-[40px] h-[40px] bg-[#F0F1F3] rounded-full flex items-center justify-center text-[#667085]">
							<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
								<path fill-rule="evenodd"
									d="M7.502 6h7.128A3.375 3.375 0 0 1 18 9.375v9.375a3 3 0 0 0 3-3V6.108c0-1.505-1.125-2.811-2.664-2.94a48.972 48.972 0 0 0-.673-.05A3 3 0 0 0 15 1.5h-1.5a3 3 0 0 0-2.663 1.618c-.225.015-.45.032-.673.05C8.662 3.295 7.554 4.542 7.502 6ZM13.5 3A1.5 1.5 0 0 0 12 4.5h4.5A1.5 1.5 0 0 0 15 3h-1.5Z"
									clip-rule="evenodd" />
								<path fill-rule="evenodd"
									d="M3 9.375C3 8.339 3.84 7.5 4.875 7.5h9.75c1.036 0 1.875.84 1.875 1.875v11.25c0 1.035-.84 1.875-1.875 1.875h-9.75A1.875 1.875 0 0 1 3 20.625V9.375ZM6 12a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75H6.75a.75.75 0 0 1-.75-.75V12Zm2.25 0a.75.75 0 0 1 .75-.75h3.75a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75ZM6 15a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75H6.75a.75.75 0 0 1-.75-.75V15Zm2.25 0a.75.75 0 0 1 .75-.75h3.75a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75ZM6 18a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75H6.75a.75.75 0 0 1-.75-.75V18Zm2.25 0a.75.75 0 0 1 .75-.75h3.75a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75Z"
									clip-rule="evenodd" />
							</svg>
						</div>
						<div class="flex flex-col relative z-50">
							<h1 class="mb-0 font-semibold text-[14px] text-[#667085]">Cliente ID</h1>
							<p class="mb-0 font-semibold text-[14px]">ID-011221</p>
						</div>
					</div>
					<div class="flex items-center px-[24px] gap-4">
						<div class="w-[40px] h-[40px] bg-[#F0F1F3] rounded-full flex items-center justify-center text-[#667085]">
							<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
								<path d="M10.5 18.75a.75.75 0 0 0 0 1.5h3a.75.75 0 0 0 0-1.5h-3Z" />
								<path fill-rule="evenodd"
									d="M8.625.75A3.375 3.375 0 0 0 5.25 4.125v15.75a3.375 3.375 0 0 0 3.375 3.375h6.75a3.375 3.375 0 0 0 3.375-3.375V4.125A3.375 3.375 0 0 0 15.375.75h-6.75ZM7.5 4.125C7.5 3.504 8.004 3 8.625 3H9.75v.375c0 .621.504 1.125 1.125 1.125h2.25c.621 0 1.125-.504 1.125-1.125V3h1.125c.621 0 1.125.504 1.125 1.125v15.75c0 .621-.504 1.125-1.125 1.125h-6.75A1.125 1.125 0 0 1 7.5 19.875V4.125Z"
									clip-rule="evenodd" />
							</svg>
						</div>
						<div class="flex flex-col relative z-50">
							<h1 class="mb-0 font-semibold text-[14px] text-[#667085]">Telefone</h1>
							<p class="mb-0 font-semibold text-[14px]">050 414 8778</p>
						</div>
					</div>
					<div class="flex items-center px-[24px] gap-4">
						<div class="w-[40px] h-[40px] bg-[#F0F1F3] rounded-full flex items-center justify-center text-[#667085]">
							<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
								<path fill-rule="evenodd"
									d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 0 0 0-1.5h-3.75V6Z"
									clip-rule="evenodd" />
							</svg>
						</div>
						<div class="flex flex-col relative z-50">
							<h1 class="mb-0 font-semibold text-[14px] text-[#667085]">Última vez online</h1>
							<p class="mb-0 font-semibold text-[14px]">1 Dia atrás</p>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="w-[70%] 2xl:[75%]">

			<div class="flex items-center gap-3">

				<div class="px-[24px] bg-white flex py-[11px] flex-grow flex gap-3 rounded-xl justify-between">
					<div class="flex flex-col">
						<p class="mb-0 text-[16px] text-[#667085] ">Item A</p>
						<h1 class="font-semibold text-[24px]">2,400</h1>
						<p class="mb-0"><strong class="text-[#1A9882]">1%</strong> <span class="text-[#858D9D] font-semibold">+24
								esse mês</span></p>
					</div>
					<div class="rounded-[8px] bg-[#FFE8E0] w-[36px] h-[36px] flex items-center justify-center text-[#F86624]">
						<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
							<path
								d="M2.25 2.25a.75.75 0 0 0 0 1.5h1.386c.17 0 .318.114.362.278l2.558 9.592a3.752 3.752 0 0 0-2.806 3.63c0 .414.336.75.75.75h15.75a.75.75 0 0 0 0-1.5H5.378A2.25 2.25 0 0 1 7.5 15h11.218a.75.75 0 0 0 .674-.421 60.358 60.358 0 0 0 2.96-7.228.75.75 0 0 0-.525-.965A60.864 60.864 0 0 0 5.68 4.509l-.232-.867A1.875 1.875 0 0 0 3.636 2.25H2.25ZM3.75 20.25a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM16.5 20.25a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z" />
						</svg>
					</div>
				</div>

				<div class="px-[24px] bg-white flex py-[11px] flex-grow flex gap-3 rounded-xl justify-between">
					<div class="flex flex-col">
						<p class="mb-0 text-[16px] text-[#667085] ">Item B</p>
						<h1 class="font-semibold text-[24px]">$100.00</h1>
						<p class="mb-0"><strong class="text-[#1A9882]">10%</strong> <span class="text-[#858D9D] font-semibold">+$10
								hoje</span></p>
					</div>
					<div class="rounded-[8px] bg-[#F4ECFB] w-[36px] h-[36px] flex items-center justify-center text-[#F86624]">
						<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
							class="w-6 h-6 text-[#883DCF]">
							<path d="M12 7.5a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5Z" />
							<path fill-rule="evenodd"
								d="M1.5 4.875C1.5 3.839 2.34 3 3.375 3h17.25c1.035 0 1.875.84 1.875 1.875v9.75c0 1.036-.84 1.875-1.875 1.875H3.375A1.875 1.875 0 0 1 1.5 14.625v-9.75ZM8.25 9.75a3.75 3.75 0 1 1 7.5 0 3.75 3.75 0 0 1-7.5 0ZM18.75 9a.75.75 0 0 0-.75.75v.008c0 .414.336.75.75.75h.008a.75.75 0 0 0 .75-.75V9.75a.75.75 0 0 0-.75-.75h-.008ZM4.5 9.75A.75.75 0 0 1 5.25 9h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75H5.25a.75.75 0 0 1-.75-.75V9.75Z"
								clip-rule="evenodd" />
							<path
								d="M2.25 18a.75.75 0 0 0 0 1.5c5.4 0 10.63.722 15.6 2.075 1.19.324 2.4-.558 2.4-1.82V18.75a.75.75 0 0 0-.75-.75H2.25Z" />
						</svg>
					</div>
				</div>

				<div class="px-[24px] bg-white flex py-[11px] flex-grow flex gap-3 rounded-xl justify-between">
					<div class="flex flex-col">
						<p class="mb-0 text-[16px] text-[#667085] ">Item C</p>
						<h1 class="font-semibold text-[24px]">1,400</h1>
						<p class="mb-0"><strong class="text-[#1A9882]">10%</strong> <span class="text-[#858D9D] font-semibold">+120 hoje</span></p>
					</div>
					<div class="rounded-[8px] bg-[#E9FAF7] w-[36px] h-[36px] flex items-center justify-center text-[#22CAAD]">
						<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
							<path fill-rule="evenodd"
								d="M5.166 2.621v.858c-1.035.148-2.059.33-3.071.543a.75.75 0 0 0-.584.859 6.753 6.753 0 0 0 6.138 5.6 6.73 6.73 0 0 0 2.743 1.346A6.707 6.707 0 0 1 9.279 15H8.54c-1.036 0-1.875.84-1.875 1.875V19.5h-.75a2.25 2.25 0 0 0-2.25 2.25c0 .414.336.75.75.75h15a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-2.25-2.25h-.75v-2.625c0-1.036-.84-1.875-1.875-1.875h-.739a6.706 6.706 0 0 1-1.112-3.173 6.73 6.73 0 0 0 2.743-1.347 6.753 6.753 0 0 0 6.139-5.6.75.75 0 0 0-.585-.858 47.077 47.077 0 0 0-3.07-.543V2.62a.75.75 0 0 0-.658-.744 49.22 49.22 0 0 0-6.093-.377c-2.063 0-4.096.128-6.093.377a.75.75 0 0 0-.657.744Zm0 2.629c0 1.196.312 2.32.857 3.294A5.266 5.266 0 0 1 3.16 5.337a45.6 45.6 0 0 1 2.006-.343v.256Zm13.5 0v-.256c.674.1 1.343.214 2.006.343a5.265 5.265 0 0 1-2.863 3.207 6.72 6.72 0 0 0 .857-3.294Z"
								clip-rule="evenodd" />
						</svg>
					</div>
				</div>

			</div>


			<!-- Chart -->
			<div class="bg-white px-4 py-5 rounded-xl mt-[24px] w-full h-[551px]">
				<div class="flex justify-between items-center">
					<div class="flex flex-col">
						<h1 class="mb-0 font-bold text-[20px]">Progresso de Vendas</h1>
						<p class="mb-0 text-[#777980] text-[14px] font-semibold">Objetivo</p>
					</div>
					<div>
						<button>
							<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
								<path fill-rule="evenodd"
									d="M10.5 6a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Zm0 6a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Zm0 6a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"
									clip-rule="evenodd" />
							</svg>
						</button>
					</div>
				</div>
				<Chart :chart-data="chartDataPie" :chart-options="chartOptionsPie" type="line" :responsive="true"
					styleDynamic="w-full 2xl:h-[350px] h-[150px]" />
			</div>
		</div>

	</div>

</template>

<script>
export default {
	data() {
		return {
			interval: null,
			time: null,
			dateString: null
		}
	},
	methods: {
		updateTime() {
			const now = new Date();
			// Obter as horas, minutos e segundos
			const hours = now.getHours();
			const minutes = now.getMinutes();
			const seconds = now.getSeconds();
			// Converter para formato AM/PM
			const timeString = hours >= 12 ? 'PM' : 'AM';
			const formattedHours = hours % 12 || 12;
			const formattedMinutes = minutes < 10 ? '0' + minutes : minutes;
			const formattedSeconds = seconds < 10 ? '0' + seconds : seconds;
			// Atualizar o estado
			this.time = `${formattedHours}:${formattedMinutes}:${formattedSeconds} ${timeString}`;
		},
		updateDateString() {
			const now = new Date();
			// Obter o dia da semana, dia do mês, mês e ano
			const daysOfWeek = ['Domingo', 'Segunda-feira', 'Terça-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'Sábado'];
			const monthsOfYear = ['janeiro', 'fevereiro', 'março', 'abril', 'maio', 'junho', 'julho', 'agosto', 'setembro', 'outubro', 'novembro', 'dezembro'];
			const dayOfWeek = daysOfWeek[now.getDay()];
			const dayOfMonth = now.getDate();
			const month = monthsOfYear[now.getMonth()];
			const year = now.getFullYear();
			// Construir a string de data
			this.dateString = `${dayOfWeek}, ${dayOfMonth} de ${month} de ${year}`;
		}
	},
	created() {
		// Atualizar o tempo a cada segundo
		this.interval = setInterval(() => {
			this.updateTime();
		}, 1000);

		// Atualizar a string de data a cada segundo
		this.interval = setInterval(() => {
			this.updateDateString();
		}, 1000);
	},
	beforeDestroy() {
		// Prevenir vazamento de memória
		clearInterval(this.interval);
	}
}
</script>



<script setup>
import Checkbox from "primevue/checkbox";
import SlideUpDown from "vue3-slide-up-down";
import Button from "primevue/button";
import InputText from "primevue/inputtext";
import Dropdown from "primevue/dropdown";
import Pagination from "../../Components/Pagination.vue";
import Actions from "../../Components/Tables/Actions.vue";
import Delete from "../../Components/Modals/Delete.vue";
import Chart from "../../Components/Chart.vue";
import { Link } from "@inertiajs/inertia-vue3";
import { ref, defineProps, watch, reactive } from "vue";
import { Inertia } from "@inertiajs/inertia";
import { useForm } from "@inertiajs/inertia-vue3";
import { useToast } from "vue-toastification";
import ModalDelete from "@/Components/Modals/Delete";
const _ = require("lodash");

const props = defineProps({
	dataTable: Object,
	ContasAVencer: Object,
	Registros: Object,
	OrdemdeServico: Object,
	AlertaError: Object,
});

const data_mock = [
	{ latterName: 'SR', name: 'Sosro', projectName: 'Internal CMS Tools', progress: '80%', initialDate: '19/03/2024', endDate: '25/03/2024' },
	{ latterName: 'EV', name: 'Elavania', projectName: 'E-Commerce App Phase 01', progress: '100%', initialDate: '19/03/2024', endDate: '25/03/2024' },
	{ latterName: 'SR', name: 'Sosro', projectName: 'Internal CMS Tools', progress: '60%', initialDate: '21/03/2024', endDate: '25/03/2024' },
	{ latterName: 'EV', name: 'Elavania', projectName: 'E-Commerce App Phase 01', progress: '20%', initialDate: '21/03/2024', endDate: '25/03/2024' },
]

const showDeleteModal = ref({
	id: null,
	show: false,
});

const AlertaError = props.AlertaError;

const searchBy = ref(getParams("searchBy") || "0");
const searchBy2 = ref(getParams("searchBy2") || "0");
const statusValue = ref(getParams("byStatus"));

const status = [
	{ label: "Ativo", code: '0' },
	{ label: "Inativo", code: '1' },
];

const chartDataPie = {
	labels: ['Item 1', 'Item 2', 'Item 3', 'Item 4'],
	datasets: [
		{
			backgroundColor: ['#41B883', '#E46651', '#00D8FF', '#DD1B16'],
			data: [40, 20, 80, 10]
		}
	]
}

const chartOptionsPie = {
	responsive: true,
	maintainAspectRatio: false
}

const chartData = {
	labels: ['2012', '2013', '2014', '2015', '2016'],
	datasets: [{
		label: 'Yellow',
		data: [12, 19, 3, 5, 2],
		backgroundColor: 'yellow'
	}, {
		label: 'Green',
		data: [8, 15, 5, 10, 4],
		backgroundColor: 'green'
	}]
}

const chartOptions = {
	scales: {
		y: {
			beginAtZero: true
		}
	}
}

const toast = useToast();

const InputsRequired = { empresa_vinculada: "", id_fixo: "", id_ordem_servico: "", data_prevista: "", data_realizada: "", tipo: "", valor: "", obs: "", created_at: "", };

const form = useForm({

	empresa_vinculada: "",

	id_fixo: "",

	id_ordem_servico: "",

	data_prevista: "",

	data_realizada: "",

	tipo: "",

	valor: "",

	obs: "",

	created_at: "",

});

const recordValue = ref(getParams("limit") || 10);

const orderBy = ref(["column", "sorting"]);

const toggleFilter = ref(false);
const toggleDetalhamento = ref(false);



const sortVal = {
	empresa_vinculada: 1,
	id_fixo: 1,
	id_ordem_servico: 1,
	data_prevista: 1,
	data_realizada: 1,
	tipo: 1,
	valor: 1,
	obs: 1,
	created_at: 1,
};

const formColumns = useForm({
	route_of_list: "list.Financeiro",
	columns: {
		empresa_vinculada: validateColumnsVisibility("empresa_vinculada"),
		id_fixo: validateColumnsVisibility("id_fixo"),
		id_ordem_servico: validateColumnsVisibility("id_ordem_servico"),
		data_prevista: validateColumnsVisibility("data_prevista"),
		data_realizada: validateColumnsVisibility("data_realizada"),
		tipo: validateColumnsVisibility("tipo"),
		valor: validateColumnsVisibility("valor"),
		obs: validateColumnsVisibility("obs"),
		created_at: validateColumnsVisibility("created_at"),
	},
});

function validateColumnsVisibility(column) {
	let columnValue = Inertia.page.props.columnsTable?.[column];
	if (typeof columnValue == "boolean") {
		return columnValue;
	}
	return true;
}
ExibiAlertas();


function toggleColumns() {
	formColumns.post(route("toggle.columns.tables"), {
		preserveState: true,
	});
}
function sortTable(sort) {
	if (sort) {
		return 0;
	} else {
		return 1;
	}
}

function hasFilterActived() {
	if (
		getParams("searchBy") !== null ||
		getParams("searchBy2") !== null ||
		getParams("limit") !== null ||
		getParams("orderBy") !== null
	) {
		return true;
	}
	return false;
}

function setModalDeleteVal(id) {
	showDeleteModal.value.id = id;
	showDeleteModal.value.show = true;
}


function redirectToItem(token) {
	const id = token;
	Inertia.visit(route('form.update.Financeiro', { id: id },), {
		preserveScroll: true,
		onSuccess: () => toast.info('Você foi redirecionado com sucesso. Após atualizar a informação desejada, você será direcionado ao Financeiro Geral. Para voltar ao Dashboard, selecione a opção no menu lateral em Dashboard.'),
	});
}

function addFinanceiro() {

	for (const formKey in InputsRequired) {
		if (form[formKey] == '') {
			toast.info('Todos os campos são obrigatórios!');
			return false;
		}
	}


	form.post(route('storeAjax.Financeiro'), {
		preserveScroll: true,
		onError: () => toast.error('Mensagem de erro.'),
		onSuccess: () => {
			form.reset();
			toast.success("Dados armarzenados com sucesso!");
		},
	});
}



function DeleteFinanceiro(financeiroIndex) {
	const id = financeiroIndex;
	Inertia.post(route('deleteAjax.Financeiro', { id: id },), {
		preserveScroll: true,
		onSuccess: () => toast.error('Campo apagado com sucesso!'),
	})
}


function updateFinanceiro(financeiroIndex) {
	const financeiro = props.dataTable?.data[financeiroIndex];
	const id = financeiro.id;
	Inertia.post(route('updateAjax.Financeiro', { id: id },), financeiro, {
		preserveScroll: true,
		onSuccess: () => toast.success('Campo editado com sucesso!'),
	})
}

function ExibiAlertas() {
	if (AlertaError == 1) {
		toast.error('Atenção! Usuário não autorizado.');
		console.log('1');
	}
}

function resetFilter() {
	window.history.replaceState(null, null, window.location.pathname);
	recordValue.value = 10;
	searchBy.value = "0";
	searchBy2.value = "0";
	Inertia.reload();
}

function setParams() {
	let data = {
		limit: recordValue?.value,
		searchBy: searchBy.value,
		searchBy2: searchBy2.value,
		byStatus: statusValue?.value?.value,
	};

	!orderBy.value?.length ? (data.orderBy = orderBy?.value) : "";

	Inertia.visit("", {
		preserveState: true,
		replace: false,
		data,
	});
}

const setParamsWithThrottle = _.throttle(setParams, 600);
</script>